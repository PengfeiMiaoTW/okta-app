{
  "source": {
    "name": "Generate Password",
    "passwordConfig": {
      "length": 24,
      "numbers": true,
      "symbols": false,
      "lowercase": true,
      "excludeSimilarCharacters": false,
      "exclude": "",
      "strict": false
    },
    "action": {
      "type": "GENERATE_PASSWORD"
    }
  },
  "consumers": [
    {
      "name": "Test Secret Manager 1",
      "action": {
        "type": "GCP_SECRET_MANAGER_CONSUMER",
        "secretName": "${GCP_SECRET_NAME}",
        "keyFieldName": "eventSubscription.apiToken",
        "isValueArray": true,
        "projectId": "${GCP_PROJECT_ID}",
        "authentication": {
          "scopes": [],
          "type": "GCP_SERVICE_ACCOUNT",
          "credentials": "${GCLOUD_KEY}"
        }
      }
    },
    {
      "name": "Test Secret Manager 2",
      "action": {
        "type": "GCP_SECRET_MANAGER_CONSUMER",
        "secretName": "${GCP_SECRET_NAME}",
        "keyFieldName": "eventSubscription.serviceToken",
        "projectId": "${GCP_PROJECT_ID}",
        "authentication": {
          "scopes": [],
          "type": "GCP_SERVICE_ACCOUNT",
          "credentials": "${GCLOUD_KEY}"
        }
      },
      "redeploy": {
        "workflowId": "${WORKFLOW_ID}",
        "jobId": "${JOB_ID}",
        "accessToken": "${CIRCLE_CI_ACCESS_TOKEN}"
      }
    },
    {
      "name": "Event subscription token token",
      "action": {
        "type": "EVENT_SUBSCRIPTION_TOKEN",
        "eventSubscriptionName": "${EVENT_SUBSCRIPTION_NAME}",
        "eventSubscriptionAuthHeaderName": "${EVENT_SUBSCRIPTION_AUTH_HEADER_NAME}",
        "apiPlatformUrl": "${API_PLATFORM_URL}",
        "authentication": {
          "clientId": "${API_PLATFORM_CLIENT_ID}",
          "clientSecret": "${API_PLATFORM_CLIENT_SECRET}",
          "tokenUrl": "${API_PLATFORM_TOKEN_URL}",
          "scope": "events.${EVENT_SUBSCRIPTION_NAME}",
          "grantType": "${API_PLATFORM_ACCESS_TOKEN_GRANT_TYPE}",
          "type": "OAUTH_2"
        }
      }
    }
  ]
}

