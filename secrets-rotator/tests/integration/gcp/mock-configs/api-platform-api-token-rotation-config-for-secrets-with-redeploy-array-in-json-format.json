{
  "source": {
    "name": "Generate Password",
    "passwordConfig": {
      "length": 24,
      "numbers": true,
      "symbols": false,
      "lowercase": true,
      "excludeSimilarCharacters": false,
      "exclude": "",
      "strict": false
    },
    "action": {
      "type": "GENERATE_PASSWORD"
    }
  },
  "consumers": [
    {
      "name": "Test Secret Manager 1",
      "action": {
        "type": "GCP_SECRET_MANAGER_CONSUMER",
        "secretName": "${GCP_SECRET_NAME}",
        "keyFieldNames": [
          {
            "keyFieldName": "apiPlatform.apiToken",
            "isValueArray": true
          },
          {
            "keyFieldName": "apiPlatform.serviceToken"
          }
        ],
        "projectId": "${GCP_PROJECT_ID}",
        "authentication": {
          "scopes": [],
          "type": "GCP_SERVICE_ACCOUNT",
          "credentials": "${GCLOUD_KEY}"
        }
      },
      "redeploy": [
        {
          "workflowId": "${WORKFLOW_ID}",
          "jobId": "${JOB_ID}",
          "accessToken": "${CIRCLE_CI_ACCESS_TOKEN}"
        },
        {
          "workflowId": "${WORKFLOW_ID_SERVICE_TWO}",
          "jobId": "${JOB_ID_SERVICE_TWO}",
          "accessToken": "${CIRCLE_CI_ACCESS_TOKEN}"
        }
      ]
    },
    {
      "name": "API Platform service token",
      "action": {
        "type": "API_PLATFORM_API_SERVICE_TOKEN_CONSUMER",
        "apiName": "${API_PLATFORM_API_NAME}",
        "apiKeyHeaderName": "x-api-key",
        "apiPlatformUrl": "${API_PLATFORM_URL}",
        "authentication": {
          "clientId": "${API_PLATFORM_CLIENT_ID}",
          "clientSecret": "${API_PLATFORM_CLIENT_SECRET}",
          "tokenUrl": "${API_PLATFORM_TOKEN_URL}",
          "scope": "${API_PLATFORM_ACCESS_TOKEN_SCOPE}",
          "grantType": "${API_PLATFORM_ACCESS_TOKEN_GRANT_TYPE}",
          "type": "OAUTH_2"
        }
      }
    }
  ]
}

